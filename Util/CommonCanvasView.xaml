<UserControl x:Class="MVP_Voltage.Util.CommonCanvasView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:cvt="clr-namespace:MVP_Voltage.Converter"
             xmlns:local="clr-namespace:MVP_Voltage.Util"
             xmlns:thm="clr-namespace:MVP_Voltage.Themes"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
        <i:Interaction.Triggers>
            <!--<i:EventTrigger EventName="MouseLeftButtonDown">
            <i:InvokeCommandAction Command="{Binding Path=CommandInformationBoardMouseDown}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
        <i:EventTrigger EventName="MouseLeftButtonUp">
            <i:InvokeCommandAction Command="{Binding Path=CommandInformationBoardMouseUp}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
        <i:EventTrigger EventName="MouseMove">
            <i:InvokeCommandAction Command="{Binding Path=CommandInformationBoardMouseMove}" PassEventArgsToCommand="True" />
        </i:EventTrigger>-->
            <i:EventTrigger EventName="PreviewKeyUp">
                <i:InvokeCommandAction Command="{Binding ImageConvertViewModelKeyEvent.EventKeyUp}" PassEventArgsToCommand="True" />
            </i:EventTrigger>
            <i:EventTrigger EventName="KeyDown">
                <i:InvokeCommandAction Command="{Binding ImageConvertViewModelKeyEvent.EventKeyDown}" PassEventArgsToCommand="True" />
            </i:EventTrigger>
        </i:Interaction.Triggers>

        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Panel.ZIndex="20" BorderBrush="{DynamicResource MahApps.Brushes.ThemeForeground}" BorderThickness="2" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
            <Grid Background="{DynamicResource MahApps.Brushes.ThemeBackground}" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.Resources>
                    <Style TargetType="TextBlock">
                        <Setter Property="VerticalAlignment" Value="Center" />
                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                    </Style>
                </Grid.Resources>
                <mah:NumericUpDown Grid.Column="0" Grid.RowSpan="2" Value="{Binding ImageShow.ImageScaleX}" Minimum="0.01" Interval="0.1" mah:TextBoxHelper.UseFloatingWatermark="True" mah:TextBoxHelper.Watermark="Zoom" StringFormat="0 %" Margin="5" />

                <Rectangle Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" Width="25" Height="25" Fill="{Binding ColorBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Stroke="{DynamicResource MahApps.Brushes.ThemeForeground}" />

                <Grid Grid.Column="3" Grid.Row="0" VerticalAlignment="Center" Margin="5" HorizontalAlignment="Stretch" >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" >
                        <TextBlock Text="X :" />
                        <TextBlock Text="{Binding MouseXonCanvas, StringFormat={}{0:0}}" />
                    </StackPanel>
                    <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" >
                        <TextBlock Text="Y :" />
                        <TextBlock Text="{Binding MouseYonCanvas, StringFormat={}{0:0}}" />
                    </StackPanel>
                    <StackPanel Grid.Column="0" Grid.Row="1" Orientation="Horizontal" >
                        <TextBlock HorizontalAlignment="Center" >
        <Run Text="Width" />
        <Run Text=": " />
                        </TextBlock>
                        <TextBlock Text="{Binding ImageShow.Image.Source.Width, StringFormat={}{0:0}}" HorizontalAlignment="Center" />
                    </StackPanel>
                    <StackPanel Grid.Column="1" Grid.Row="1" Orientation="Horizontal" >
                        <TextBlock HorizontalAlignment="Center" >
        <Run Text="Height" />
        <Run Text=": " />
                        </TextBlock>
                        <TextBlock Text="{Binding ImageShow.Image.Source.Height, StringFormat={}{0:0}}" HorizontalAlignment="Center" />
                    </StackPanel>
                </Grid>

                <Grid Grid.Column="2" Grid.Row="1" Margin="5" VerticalAlignment="Center" HorizontalAlignment="Stretch" >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" >
                        <Rectangle Width="10" Height="10" Fill="{Binding RBrush}" VerticalAlignment="Center"  />
                        <TextBlock Text="R :" />
                        <TextBlock Text="{Binding RValue}" />
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" >
                        <Rectangle Width="10" Height="10" Fill="{Binding GBrush}" VerticalAlignment="Center" />
                        <TextBlock Text="G :" />
                        <TextBlock Text="{Binding GValue}" />
                    </StackPanel>
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Rectangle Width="10" Height="10" Fill="{Binding BBrush}" VerticalAlignment="Center" />
                        <TextBlock Text="B :" Margin="0" />
                        <TextBlock Text="{Binding BValue}" Margin="0" />
                    </StackPanel>
                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <Rectangle Width="10" Height="10" Fill="{Binding ABrush}" Stroke="{DynamicResource MahApps.Brushes.ThemeForeground}"
           Opacity="{Binding AValuePercent}" VerticalAlignment="Center" />
                        <TextBlock Text="A :" />
                        <TextBlock Text="{Binding AValue}" />
                    </StackPanel>
                </Grid>


            </Grid>
        </Border>
        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Visible" VerticalScrollBarVisibility="Visible" Panel.ZIndex="0" KeyboardNavigation.TabNavigation="Local" Focusable="True"  >

            <Canvas x:Name="PART_Canvas" Background="{Binding ImageShow.ImageBrush}" Width="{Binding ImageShow.Image.Source.Width}" Height="{Binding ImageShow.Image.Source.Height}" RenderOptions.BitmapScalingMode="NearestNeighbor" >
                <Canvas.LayoutTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="{Binding ImageShow.ImageScaleX}" ScaleY="{Binding ImageShow.ImageScaleX}" ></ScaleTransform>
                    </TransformGroup>
                </Canvas.LayoutTransform>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Loaded">
                        <i:InvokeCommandAction Command="{Binding Path=CommandLoaded}" PassEventArgsToCommand="True" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="PreviewMouseMove">
                        <i:InvokeCommandAction Command="{Binding Path=CanvasEventPreviewMouseMove}" PassEventArgsToCommand="True"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="PreviewMouseDown">
                        <i:InvokeCommandAction Command="{Binding Path=CanvasEventPreviewMouseDown}" PassEventArgsToCommand="True"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="PreviewMouseUp">
                        <i:InvokeCommandAction Command="{Binding Path=CanvasEventPreviewMouseUp}" PassEventArgsToCommand="True"/>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MouseWheel">
                        <i:InvokeCommandAction Command="{Binding Path=CanvasEventMouseWheel}" PassEventArgsToCommand="True"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <Image Source="{Binding ImageShow.Image.Source}" Opacity="{Binding ImageOpacity}" Visibility="{Binding ImageVisibilityBool, Converter={cvt:BoolToVisibilityConverter}}" />

                <thm:ROISelectorControl Panel.ZIndex="11"
                               Visibility="{Binding IsRoiVisible, RelativeSource={RelativeSource AncestorType=local:CommonCanvasView},
                         Converter={cvt:BoolToVisibilityConverter}}"
                               Roi="{Binding Roi, RelativeSource={RelativeSource AncestorType=local:CommonCanvasView}}"
    BoundsW="{Binding ActualWidth, ElementName=PART_Canvas}"
    BoundsH="{Binding ActualHeight, ElementName=PART_Canvas}"
    HandleSize="{Binding RoiHandleSize, RelativeSource={RelativeSource AncestorType=local:CommonCanvasView}}"
    DimOpacity="{Binding RoiDimOpacity, RelativeSource={RelativeSource AncestorType=local:CommonCanvasView}}" />
            </Canvas>
        </ScrollViewer>
    </Grid>
</UserControl>
